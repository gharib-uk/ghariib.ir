<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>&lt;div&gt;What&#39;s new in Git 2.49.0?&lt;/div&gt;</title>
	
	
	<link rel="stylesheet" href="/css/style.css">
	
	
</head>
<body>
	<header>
	==========================<br>
	== <a href="https://ghariib.ir/">Gharib Personal Blog</a> ==<br>
	==========================
	<div style="float: right;">A Techi Personal Blog</div><br>
	<p>
	<nav>
			<a href="/"><b>Start</b></a>.
			
			
			<a href="/posts/"><b>Posts</b></a>.
			
			<a href="/categories/"><b>Categories</b></a>.
			
			<a href="/tags/"><b>Tags</b></a>.
			
	</nav>
	</p>
	
</header>

	
	<main>
		<article>
			<h1>&lt;div&gt;What&#39;s new in Git 2.49.0?&lt;/div&gt;</h1>
			<b><time>19.03.2025 00:00</time></b>
		       
		           <a href="/tags/development">development</a>
        	       
		           <a href="/tags/git">git</a>
        	       
		           <a href="/tags/github">github</a>
        	       
		           <a href="/tags/gitlab">gitlab</a>
        	       
		           <a href="/tags/software">software</a>
        	       

			<div>
				<p>The Git project recently released Git 2.49.0. Let&rsquo;s look at a few notable highlights from this release, which includes contributions from GitLab&rsquo;s Git team and the wider Git community.</p>
<p>What&rsquo;s covered:</p>
<ul>
<li>git-backfill(1) and the new path-walk API</li>
<li>Introduction of zlib-ng</li>
<li>Continued iteration on Meson</li>
<li>Deprecation of .git/branches/ and .git/remotes/</li>
<li>Rust bindings for libgit</li>
<li>New name-hashing algorithm</li>
<li>Promisor remote capability</li>
<li>Thin clone using <code>--revision</code></li>
</ul>
<h2 id="git-backfill1-and-the-new-path-walk-api">git-backfill(1) and the new path-walk API</h2>
<p>When you <code>git-clone(1)</code> a Git repository, you can pass it the <code>--filter</code> option. Using this option allows you to create a <em>partial clone</em>. In a partial clone the server only sends a subset of reachable objects according to the given object filter. For example, creating a clone with <code>--filter=blob:none</code> will not fetch any blobs (file contents) from the server and create a <em>blobless clone</em>.</p>
<p>Blobless clones have all the reachable commits and trees, but no blobs. When you perform an operation like <code>git-checkout(1)</code>, Git will download the missing blobs to complete that operation. For some operations, like <code>git-blame(1)</code>, this might result in downloading objects one by one, which will slow down the command drastically. This performance degradation occurs because <code>git-blame(1)</code> must traverse the commit history to identify which specific blobs it needs, then request each missing blob from the server separately.</p>
<p>In Git 2.49, a new subcommand <code>git-backfill(1)</code> is introduced, which can be used to download missing blobs in a blobless partial clone.</p>
<p>Under the hood, the <code>git-backfill(1)</code> command leverages the new path-walk API, which is different from how Git generally iterates over commits. Rather than iterating over the commits one at a time and recursively visiting the trees and blobs associated with each commit, the path-walk API does traversal by path. For each path, it adds a list of associated tree objects to a stack. This stack is then processed in a depth-first order. So, instead of processing every object in commit <code>1</code> before moving to commit <code>2</code>, it will process all versions of file <code>A</code> across all commits before moving to file <code>B</code>. This approach greatly improves performance in scenarios where grouping by path is essential.</p>
<p>Let me demonstrate its use by making a blobless clone of <code>gitlab-org/git</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone --filter<span style="color:#f92672">=</span>blob:none --bare --no-tags git@gitlab.com:gitlab-org/git.git
</span></span><span style="display:flex;"><span>Cloning into bare repository <span style="color:#e6db74">&#39;git.git&#39;</span>...
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 245904, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>1736/1736<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>276/276<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">245904</span> <span style="color:#f92672">(</span>delta 1591<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">1547</span> <span style="color:#f92672">(</span>delta 1459<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">244168</span> <span style="color:#f92672">(</span>from 1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>245904/245904<span style="color:#f92672">)</span>, 59.35 MiB | 15.96 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#f92672">(</span>161482/161482<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span></code></pre></div><p>Above, we use <code>--bare</code> to ensure Git doesn&rsquo;t need to download any blobs to check out an initial branch. We can verify this clone does not contain any blobs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ git cat-file --batch-all-objects --batch-check<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;%(objecttype)&#39;</span> | sort | uniq -c
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">83977</span> commit
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">161927</span> tree
</span></span></code></pre></div><p>If you want to see the contents of a file in the repository, Git has to download it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ git cat-file -p HEAD:README.md
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 1, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>from 1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, 1.64 KiB | 1.64 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>!<span style="color:#f92672">[</span>Build status<span style="color:#f92672">](</span>https://github.com/git/git/workflows/CI/badge.svg<span style="color:#f92672">)](</span>https://github.com/git/git/actions?query<span style="color:#f92672">=</span>branch%3Amaster+event%3Apush<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Git - fast, scalable, distributed revision control system
</span></span><span style="display:flex;"><span><span style="color:#f92672">=========================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Git is a fast, scalable, distributed revision control system with an
</span></span><span style="display:flex;"><span>unusually rich command set that provides both high-level operations
</span></span><span style="display:flex;"><span>and full access to internals.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>snip<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>As you can see above, Git first talks to the remote repository to download the blob before it can display it.</p>
<p>When you would like to <code>git-blame(1)</code> that file, it needs to download a lot more:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ git blame HEAD README.md
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 1, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>from 0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, 1.64 KiB | 1.64 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 1, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>from 0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, 1.64 KiB | 1.64 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 1, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>from 0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, 1.64 KiB | 1.64 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 1, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>snip<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df7375d772 README.md <span style="color:#f92672">(</span>Ævar Arnfjörð Bjarmason 2021-11-23 17:29:09 +0100  1<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>!<span style="color:#f92672">[</span>Build status<span style="color:#f92672">](</span>https://github.com/git/git/workflows/CI/badge.svg<span style="color:#f92672">)](</span>https://github.com/git/git/actions?query<span style="color:#f92672">=</span>branch%3Amaster+event%3Apush<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>5f7864663b README.md <span style="color:#f92672">(</span>Johannes Schindelin 	2019-01-29 06:19:32 -0800  2<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>28513c4f56 README.md <span style="color:#f92672">(</span>Matthieu Moy        	2016-02-25 09:37:29 +0100  3<span style="color:#f92672">)</span> Git - fast, scalable, distributed revision control system
</span></span><span style="display:flex;"><span>28513c4f56 README.md <span style="color:#f92672">(</span>Matthieu Moy        	2016-02-25 09:37:29 +0100  4<span style="color:#f92672">)</span> <span style="color:#f92672">=========================================================</span>
</span></span><span style="display:flex;"><span>556b6600b2 README	<span style="color:#f92672">(</span>Nicolas Pitre       	2007-01-17 13:04:39 -0500  5<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>556b6600b2 README	<span style="color:#f92672">(</span>Nicolas Pitre       	2007-01-17 13:04:39 -0500  6<span style="color:#f92672">)</span> Git is a fast, scalable, distributed revision control system with an
</span></span><span style="display:flex;"><span>556b6600b2 README	<span style="color:#f92672">(</span>Nicolas Pitre       	2007-01-17 13:04:39 -0500  7<span style="color:#f92672">)</span> unusually rich command set that provides both high-level operations
</span></span><span style="display:flex;"><span>556b6600b2 README	<span style="color:#f92672">(</span>Nicolas Pitre       	2007-01-17 13:04:39 -0500  8<span style="color:#f92672">)</span> and full access to internals.
</span></span><span style="display:flex;"><span>556b6600b2 README	<span style="color:#f92672">(</span>Nicolas Pitre       	2007-01-17 13:04:39 -0500  9<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>snip<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>We&rsquo;ve truncated the output, but as you can see, Git goes to the server for each revision of that file separately. That&rsquo;s really inefficient. With <code>git-backfill(1)</code> we can ask Git to download all blobs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git backfill
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 50711, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>15438/15438<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>708/708<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">50711</span> <span style="color:#f92672">(</span>delta 15154<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">14730</span> <span style="color:#f92672">(</span>delta 14730<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">35273</span> <span style="color:#f92672">(</span>from 1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>50711/50711<span style="color:#f92672">)</span>, 11.62 MiB | 12.28 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#f92672">(</span>49154/49154<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 50017, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>10826/10826<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>634/634<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">50017</span> <span style="color:#f92672">(</span>delta 10580<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">10192</span> <span style="color:#f92672">(</span>delta 10192<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">39191</span> <span style="color:#f92672">(</span>from 1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>50017/50017<span style="color:#f92672">)</span>, 12.17 MiB | 12.33 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#f92672">(</span>48301/48301<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 47303, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>7311/7311<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>618/618<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">47303</span> <span style="color:#f92672">(</span>delta 7021<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">6693</span> <span style="color:#f92672">(</span>delta 6693<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">39992</span> <span style="color:#f92672">(</span>from 1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>47303/47303<span style="color:#f92672">)</span>, 40.84 MiB | 15.26 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#f92672">(</span>43788/43788<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span></code></pre></div><p>This backfills all blobs, turning the blobless clone into a full clone:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git cat-file --batch-all-objects --batch-check<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;%(objecttype)&#39;</span> | sort | uniq -c
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">148031</span> blob
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">83977</span> commit
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">161927</span> tree
</span></span></code></pre></div><p>This project was led by Derrick Stolee and was merged with e565f37553.</p>
<h2 id="introduction-of-zlib-ng">Introduction of zlib-ng</h2>
<p>All objects in the <code>.git/</code> folder are compressed by Git using <code>zlib</code>. <code>zlib</code> is the reference implementation for the RFC 1950: ZLIB Compressed Data Format. Created in 1995, <code>zlib</code> has a long history and is incredibly portable, even supporting many systems that predate the Internet. Because of its wide support of architectures and compilers, it has limitations in what it is capable of.</p>
<p>The fork <code>zlib-ng</code> was created to accommodate the limitations. <code>zlib-ng</code> aims to be optimized for modern systems. This fork drops support for legacy systems and instead brings in patches for Intel optimizations, some Cloudflare optimizations, and a couple other smaller patches.</p>
<p>The <code>zlib-ng</code> library itself provides a compatibility layer for <code>zlib</code>. The compatibility later allows <code>zlib-ng</code> to be a drop-in replacement for <code>zlib</code>, but that layer is not available on all Linux distributions. In Git 2.49:</p>
<ul>
<li>A compatibility layer was added to the Git project.</li>
<li>Build options were added to both to the <code>Makefile</code> and Meson Build file.</li>
</ul>
<p>These additions make it easier to benefit from the performance improvements of <code>zlib-ng</code>.</p>
<p>In local benchmarks, we&rsquo;ve seen a ~25% speedup when using <code>zlib-ng</code> instead of <code>zlib</code>. And we&rsquo;re in the process of rolling out these changes to GitLab.com, too.</p>
<p>If you want to benefit from the gains of <code>zlib-ng</code>, first verify if Git on your machine is already using <code>zlib-ng</code> by running <code>git version --build-options</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git version --build-options
</span></span><span style="display:flex;"><span>git version 2.47.1
</span></span><span style="display:flex;"><span>cpu: x86_64
</span></span><span style="display:flex;"><span>no commit associated with this build
</span></span><span style="display:flex;"><span>sizeof-long: <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>sizeof-size_t: <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>shell-path: /bin/sh
</span></span><span style="display:flex;"><span>libcurl: 8.6.0
</span></span><span style="display:flex;"><span>OpenSSL: OpenSSL 3.2.2 <span style="color:#ae81ff">4</span> Jun <span style="color:#ae81ff">2024</span>
</span></span><span style="display:flex;"><span>zlib: 1.3.1.zlib-ng
</span></span></code></pre></div><p>If the last line includes <code>zlib-ng</code> then your Git is already built using the faster <code>zlib</code> variant. If not, you can either:</p>
<ul>
<li>Ask the maintainer of the Git package you are using to include <code>zlib-ng</code> support.</li>
<li>Build Git yourself from source.</li>
</ul>
<p>These changes were introduced by Patrick Steinhardt.</p>
<h2 id="continued-iteration-on-meson">Continued iteration on Meson</h2>
<p>In our article about the Git 2.48 release, we touched on the introduction of the Meson build system. Meson is a build automation tool used by the Git project that at some point might replace Autoconf, CMake, and maybe even Make.</p>
<p>During this release cycle, work continued on using Meson, adding various missing features and stabilization fixes:</p>
<ul>
<li>Improved test coverage for CI was merged in 72f1ddfbc9.</li>
<li>Bits and pieces to use Meson in <code>contrib/</code> were merged in 2a1530a953.</li>
<li>Assorted fixes and improvements to the build procedure based on meson were merged in ab09eddf60.</li>
<li>Making Meson aware of building <code>git-subtree(1)</code> was merged in 3ddeb7f337.</li>
<li>Learn Meson to generate HTML documentation pages was merged in 1b4e9a5f8b.</li>
</ul>
<p>All these efforts were carried out by Patrick Steinhardt.</p>
<h2 id="deprecation-of-gitbranches-and-gitremotes">Deprecation of .git/branches/ and .git/remotes/</h2>
<p>You are probably aware of the existence of the <code>.git</code> directory, and what is inside. But have you ever heard about the sub-directories <code>.git/branches/</code> and <code>.git/remotes/</code>? As you might know, reference to branches are stored in <code>.git/refs/heads/</code>, so that&rsquo;s not what <code>.git/branches/</code> is for, and what about <code>.git/remotes/</code>?</p>
<p>Way back in 2005, <code>.git/branches/</code> was introduced to store a shorthand name for a remote, and a few months later they were moved to <code>.git/remotes/</code>. In 2006, <code>git-config(1)</code> learned to store remotes. This has become the standard way to configure remotes and, in 2011, the directories <code>.git/branches/</code> and <code>.git/remotes/</code> were documented as being &ldquo;legacy&rdquo; and no longer used in modern repositories.</p>
<p>In 2024, the document BreakingChanges was started to outline breaking changes for the next major version of Git (v3.0). While this release is not planned to happen any time soon, this document keeps track of changes that are expected to be part of that release. In 8ccc75c245, the use of the directories <code>.git/branches/</code> and <code>.git/remotes/</code> was added to this document and that officially marks as them deprecated and to be removed in Git 3.0.</p>
<p>Thanks to Patrick Steinhardt for formalizing this deprecation.</p>
<h2 id="rust-bindings-for-libgit">Rust bindings for libgit</h2>
<p>When compiling Git, an internal library <code>libgit.a</code> is made. This library contains some of the core functionality of Git.</p>
<p>While this library (and most of Git) is written in C, in Git 2.49 bindings were added to make some of these functions available in Rust. To achieve this, two new Cargo packages were created: <code>libgit-sys</code> and <code>libgit-rs</code>. These packages live in the <code>contrib/</code> subdirectory in the Git source tree.</p>
<p>It&rsquo;s pretty common to split out a library into two packages when a Foreign Function Interface is used. The <code>libgit-sys</code> package provides the pure interface to C functions and links to the native <code>libgit.a</code> library. The package <code>libgit-rs</code> provides a high-level interface to the functions in <code>libgit-sys</code> with a feel that is more idiomatic to Rust.</p>
<p>So far, the functionality in these Rust packages is very limited. It only provides an interface to interact with the <code>git-config(1)</code>.</p>
<p>This initiative was led by Josh Steadmon and was merged with a4af0b6288.</p>
<h2 id="new-name-hashing-algorithm">New name-hashing algorithm</h2>
<p>The Git object database in <code>.git/</code> stores most of its data in packfiles. And packfiles are also used to submit objects between Git server and client over the wire.</p>
<p>You can read all about the format at <code>gitformat-pack(5)</code>. One important aspect of the packfiles is delta-compression. With delta-compression not every object is stored as-is, but some objects are saved as a <em>delta</em> of another <em>base</em>. So instead of saving the full contents of the objects, changes compared to another object are stored.</p>
<p>Without going into the details how these deltas are calculated or stored, you can imagine that it is important group files together that are very similar. In v2.48 and earlier, Git looked at the last 16 characters of the path name to determine whether blobs might be similar. This algorithm is named version <code>1</code>.</p>
<p>In Git 2.49, version <code>2</code> is available. This is an iteration on version <code>1</code>, but modified so the effect of the parent directory is reduced. You can specify the name-hash algorithm version you want to use with option <code>--name-hash-version</code> of <code>git-repack(1)</code>.</p>
<p>Derrick Stolee, who drove this project, did some comparison in resulting packfile size after running <code>git repack -adf --name-hash-version=&lt;n&gt;</code>:</p>
<table>
  <thead>
      <tr>
          <th>Repo</th>
          <th>Version 1 size</th>
          <th>Version 2 size</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>fluentui</td>
          <td>440 MB</td>
          <td>161 MB</td>
      </tr>
      <tr>
          <td>Repo B</td>
          <td>6,248 MB</td>
          <td>856 MB</td>
      </tr>
      <tr>
          <td>Repo C</td>
          <td>37,278 MB</td>
          <td>6,921 MB</td>
      </tr>
      <tr>
          <td>Repo D</td>
          <td>131,204 MB</td>
          <td>7,463 MB</td>
      </tr>
  </tbody>
</table>
<p>You can read more of the details in the patch set, which is merged in aae91a86fb.</p>
<h2 id="promisor-remote-capability">Promisor remote capability</h2>
<p>It&rsquo;s known that Git isn&rsquo;t great in dealing with large files. There are some solutions to this problem, like Git LFS, but there are still some shortcomings. To give a few:</p>
<ul>
<li>With Git LFS the user has to configure which files to put in LFS. The server has no control about that and has to serve all files.</li>
<li>Whenever a file is committed to the repository, there is no way to get it out again without rewriting history. This is annoying, especially for large files, because they are stuck for eternity.</li>
<li>Users cannot change their mind on which files to put into Git LFS.</li>
<li>A tool like Git LFS requires significant effort to set up, learn, and use correctly.</li>
</ul>
<p>For some time, Git has had the concept of promisor remotes. This feature can be used to deal with large files, and in Git 2.49 this feature took a step forward.</p>
<p>The idea for the new “promisor-remote” capability is relatively simple: Instead of sending all objects itself, a Git server can tell to the Git client &ldquo;Hey, go download these objects from <em>XYZ</em>&rdquo;. <em>XYZ</em> would be a promisor remote.</p>
<p>Git 2.49 enables the server to advertise the information of the promisor remote to the client. This change is an extension to <code>gitprotocol-v2</code>. While the server and the client are transmitting data to each other, the server can send names and URLs of the promisor remotes it knows about.</p>
<p>So far, the client is not using the promisor remote info it gets from the server during clone, so all objects are still transmitted from the remote the clone initiated from. We are planning to continue work on this feature, making it use promisor remote info from the server, and making it easier to use.</p>
<p>This patch set was submitted by Christian Couder and merged with 2c6fd30198.</p>
<h2 id="thin-clone-using---revision">Thin clone using <code>--revision</code></h2>
<p>A new <code>--revision</code> option was added to <code>git-clone(1)</code>. This enables you to create a thin clone of a repository that only contains the history of the given revision. The option is similar to <code>--branch</code>, but accepts a ref name (like <code>refs/heads/main</code>, <code>refs/tags/v1.0</code>, and <code>refs/merge-requests/123</code>) or a hexadecimal commit object ID. The difference to <code>--branch</code> is that it does not create a tracking branch and detaches <code>HEAD</code>. This means it&rsquo;s not suited if you want to contribute back to that branch.</p>
<p>You can use <code>--revision</code> in combination with <code>--depth</code> to create a very minimal clone. A suggested use-case is for automated testing. When you have a CI system that needs to check out a branch (or any reference) to perform autonomous testing on the source code, having a minimal clone is all you need.</p>
<p>This change was driven by Toon Claes.</p>
<h1 id="read-more">Read more</h1>
<ul>
<li>What’s new in Git 2.48.0?</li>
<li>What’s new in Git 2.47.0?</li>
<li>What’s new in Git 2.46.0?</li>
</ul>
<p>The Git project recently released Git 2.49.0. Let&rsquo;s look at a few notable highlights from this release, which includes contributions from GitLab&rsquo;s Git team and the wider Git community.</p>
<p>What&rsquo;s covered:</p>
<ul>
<li>git-backfill(1) and the new path-walk API</li>
<li>Introduction of zlib-ng</li>
<li>Continued iteration on Meson</li>
<li>Deprecation of .git/branches/ and .git/remotes/</li>
<li>Rust bindings for libgit</li>
<li>New name-hashing algorithm</li>
<li>Promisor remote capability</li>
<li>Thin clone using <code>--revision</code></li>
</ul>
<h2 id="git-backfill1-and-the-new-path-walk-api-1">git-backfill(1) and the new path-walk API</h2>
<p>When you <code>git-clone(1)</code> a Git repository, you can pass it the <code>--filter</code> option. Using this option allows you to create a <em>partial clone</em>. In a partial clone the server only sends a subset of reachable objects according to the given object filter. For example, creating a clone with <code>--filter=blob:none</code> will not fetch any blobs (file contents) from the server and create a <em>blobless clone</em>.</p>
<p>Blobless clones have all the reachable commits and trees, but no blobs. When you perform an operation like <code>git-checkout(1)</code>, Git will download the missing blobs to complete that operation. For some operations, like <code>git-blame(1)</code>, this might result in downloading objects one by one, which will slow down the command drastically. This performance degradation occurs because <code>git-blame(1)</code> must traverse the commit history to identify which specific blobs it needs, then request each missing blob from the server separately.</p>
<p>In Git 2.49, a new subcommand <code>git-backfill(1)</code> is introduced, which can be used to download missing blobs in a blobless partial clone.</p>
<p>Under the hood, the <code>git-backfill(1)</code> command leverages the new path-walk API, which is different from how Git generally iterates over commits. Rather than iterating over the commits one at a time and recursively visiting the trees and blobs associated with each commit, the path-walk API does traversal by path. For each path, it adds a list of associated tree objects to a stack. This stack is then processed in a depth-first order. So, instead of processing every object in commit <code>1</code> before moving to commit <code>2</code>, it will process all versions of file <code>A</code> across all commits before moving to file <code>B</code>. This approach greatly improves performance in scenarios where grouping by path is essential.</p>
<p>Let me demonstrate its use by making a blobless clone of <code>gitlab-org/git</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone --filter<span style="color:#f92672">=</span>blob:none --bare --no-tags git@gitlab.com:gitlab-org/git.git
</span></span><span style="display:flex;"><span>Cloning into bare repository <span style="color:#e6db74">&#39;git.git&#39;</span>...
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 245904, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>1736/1736<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>276/276<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">245904</span> <span style="color:#f92672">(</span>delta 1591<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">1547</span> <span style="color:#f92672">(</span>delta 1459<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">244168</span> <span style="color:#f92672">(</span>from 1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>245904/245904<span style="color:#f92672">)</span>, 59.35 MiB | 15.96 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#f92672">(</span>161482/161482<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span></code></pre></div><p>Above, we use <code>--bare</code> to ensure Git doesn&rsquo;t need to download any blobs to check out an initial branch. We can verify this clone does not contain any blobs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ git cat-file --batch-all-objects --batch-check<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;%(objecttype)&#39;</span> | sort | uniq -c
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">83977</span> commit
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">161927</span> tree
</span></span></code></pre></div><p>If you want to see the contents of a file in the repository, Git has to download it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ git cat-file -p HEAD:README.md
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 1, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>from 1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, 1.64 KiB | 1.64 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>!<span style="color:#f92672">[</span>Build status<span style="color:#f92672">](</span>https://github.com/git/git/workflows/CI/badge.svg<span style="color:#f92672">)](</span>https://github.com/git/git/actions?query<span style="color:#f92672">=</span>branch%3Amaster+event%3Apush<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Git - fast, scalable, distributed revision control system
</span></span><span style="display:flex;"><span><span style="color:#f92672">=========================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Git is a fast, scalable, distributed revision control system with an
</span></span><span style="display:flex;"><span>unusually rich command set that provides both high-level operations
</span></span><span style="display:flex;"><span>and full access to internals.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>snip<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>As you can see above, Git first talks to the remote repository to download the blob before it can display it.</p>
<p>When you would like to <code>git-blame(1)</code> that file, it needs to download a lot more:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ git blame HEAD README.md
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 1, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>from 0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, 1.64 KiB | 1.64 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 1, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>from 0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, 1.64 KiB | 1.64 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 1, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>from 0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>1/1<span style="color:#f92672">)</span>, 1.64 KiB | 1.64 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 1, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>snip<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df7375d772 README.md <span style="color:#f92672">(</span>Ævar Arnfjörð Bjarmason 2021-11-23 17:29:09 +0100  1<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>!<span style="color:#f92672">[</span>Build status<span style="color:#f92672">](</span>https://github.com/git/git/workflows/CI/badge.svg<span style="color:#f92672">)](</span>https://github.com/git/git/actions?query<span style="color:#f92672">=</span>branch%3Amaster+event%3Apush<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>5f7864663b README.md <span style="color:#f92672">(</span>Johannes Schindelin 	2019-01-29 06:19:32 -0800  2<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>28513c4f56 README.md <span style="color:#f92672">(</span>Matthieu Moy        	2016-02-25 09:37:29 +0100  3<span style="color:#f92672">)</span> Git - fast, scalable, distributed revision control system
</span></span><span style="display:flex;"><span>28513c4f56 README.md <span style="color:#f92672">(</span>Matthieu Moy        	2016-02-25 09:37:29 +0100  4<span style="color:#f92672">)</span> <span style="color:#f92672">=========================================================</span>
</span></span><span style="display:flex;"><span>556b6600b2 README	<span style="color:#f92672">(</span>Nicolas Pitre       	2007-01-17 13:04:39 -0500  5<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>556b6600b2 README	<span style="color:#f92672">(</span>Nicolas Pitre       	2007-01-17 13:04:39 -0500  6<span style="color:#f92672">)</span> Git is a fast, scalable, distributed revision control system with an
</span></span><span style="display:flex;"><span>556b6600b2 README	<span style="color:#f92672">(</span>Nicolas Pitre       	2007-01-17 13:04:39 -0500  7<span style="color:#f92672">)</span> unusually rich command set that provides both high-level operations
</span></span><span style="display:flex;"><span>556b6600b2 README	<span style="color:#f92672">(</span>Nicolas Pitre       	2007-01-17 13:04:39 -0500  8<span style="color:#f92672">)</span> and full access to internals.
</span></span><span style="display:flex;"><span>556b6600b2 README	<span style="color:#f92672">(</span>Nicolas Pitre       	2007-01-17 13:04:39 -0500  9<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>snip<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>We&rsquo;ve truncated the output, but as you can see, Git goes to the server for each revision of that file separately. That&rsquo;s really inefficient. With <code>git-backfill(1)</code> we can ask Git to download all blobs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git backfill
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 50711, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>15438/15438<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>708/708<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">50711</span> <span style="color:#f92672">(</span>delta 15154<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">14730</span> <span style="color:#f92672">(</span>delta 14730<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">35273</span> <span style="color:#f92672">(</span>from 1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>50711/50711<span style="color:#f92672">)</span>, 11.62 MiB | 12.28 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#f92672">(</span>49154/49154<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 50017, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>10826/10826<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>634/634<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">50017</span> <span style="color:#f92672">(</span>delta 10580<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">10192</span> <span style="color:#f92672">(</span>delta 10192<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">39191</span> <span style="color:#f92672">(</span>from 1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>50017/50017<span style="color:#f92672">)</span>, 12.17 MiB | 12.33 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#f92672">(</span>48301/48301<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 47303, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>7311/7311<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>618/618<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">47303</span> <span style="color:#f92672">(</span>delta 7021<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">6693</span> <span style="color:#f92672">(</span>delta 6693<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">39992</span> <span style="color:#f92672">(</span>from 1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>47303/47303<span style="color:#f92672">)</span>, 40.84 MiB | 15.26 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#f92672">(</span>43788/43788<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span></code></pre></div><p>This backfills all blobs, turning the blobless clone into a full clone:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git cat-file --batch-all-objects --batch-check<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;%(objecttype)&#39;</span> | sort | uniq -c
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">148031</span> blob
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">83977</span> commit
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">161927</span> tree
</span></span></code></pre></div><p>This project was led by Derrick Stolee and was merged with e565f37553.</p>
<h2 id="introduction-of-zlib-ng-1">Introduction of zlib-ng</h2>
<p>All objects in the <code>.git/</code> folder are compressed by Git using <code>zlib</code>. <code>zlib</code> is the reference implementation for the RFC 1950: ZLIB Compressed Data Format. Created in 1995, <code>zlib</code> has a long history and is incredibly portable, even supporting many systems that predate the Internet. Because of its wide support of architectures and compilers, it has limitations in what it is capable of.</p>
<p>The fork <code>zlib-ng</code> was created to accommodate the limitations. <code>zlib-ng</code> aims to be optimized for modern systems. This fork drops support for legacy systems and instead brings in patches for Intel optimizations, some Cloudflare optimizations, and a couple other smaller patches.</p>
<p>The <code>zlib-ng</code> library itself provides a compatibility layer for <code>zlib</code>. The compatibility later allows <code>zlib-ng</code> to be a drop-in replacement for <code>zlib</code>, but that layer is not available on all Linux distributions. In Git 2.49:</p>
<ul>
<li>A compatibility layer was added to the Git project.</li>
<li>Build options were added to both to the <code>Makefile</code> and Meson Build file.</li>
</ul>
<p>These additions make it easier to benefit from the performance improvements of <code>zlib-ng</code>.</p>
<p>In local benchmarks, we&rsquo;ve seen a ~25% speedup when using <code>zlib-ng</code> instead of <code>zlib</code>. And we&rsquo;re in the process of rolling out these changes to GitLab.com, too.</p>
<p>If you want to benefit from the gains of <code>zlib-ng</code>, first verify if Git on your machine is already using <code>zlib-ng</code> by running <code>git version --build-options</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git version --build-options
</span></span><span style="display:flex;"><span>git version 2.47.1
</span></span><span style="display:flex;"><span>cpu: x86_64
</span></span><span style="display:flex;"><span>no commit associated with this build
</span></span><span style="display:flex;"><span>sizeof-long: <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>sizeof-size_t: <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>shell-path: /bin/sh
</span></span><span style="display:flex;"><span>libcurl: 8.6.0
</span></span><span style="display:flex;"><span>OpenSSL: OpenSSL 3.2.2 <span style="color:#ae81ff">4</span> Jun <span style="color:#ae81ff">2024</span>
</span></span><span style="display:flex;"><span>zlib: 1.3.1.zlib-ng
</span></span></code></pre></div><p>If the last line includes <code>zlib-ng</code> then your Git is already built using the faster <code>zlib</code> variant. If not, you can either:</p>
<ul>
<li>Ask the maintainer of the Git package you are using to include <code>zlib-ng</code> support.</li>
<li>Build Git yourself from source.</li>
</ul>
<p>These changes were introduced by Patrick Steinhardt.</p>
<h2 id="continued-iteration-on-meson-1">Continued iteration on Meson</h2>
<p>In our article about the Git 2.48 release, we touched on the introduction of the Meson build system. Meson is a build automation tool used by the Git project that at some point might replace Autoconf, CMake, and maybe even Make.</p>
<p>During this release cycle, work continued on using Meson, adding various missing features and stabilization fixes:</p>
<ul>
<li>Improved test coverage for CI was merged in 72f1ddfbc9.</li>
<li>Bits and pieces to use Meson in <code>contrib/</code> were merged in 2a1530a953.</li>
<li>Assorted fixes and improvements to the build procedure based on meson were merged in ab09eddf60.</li>
<li>Making Meson aware of building <code>git-subtree(1)</code> was merged in 3ddeb7f337.</li>
<li>Learn Meson to generate HTML documentation pages was merged in 1b4e9a5f8b.</li>
</ul>
<p>All these efforts were carried out by Patrick Steinhardt.</p>
<h2 id="deprecation-of-gitbranches-and-gitremotes-1">Deprecation of .git/branches/ and .git/remotes/</h2>
<p>You are probably aware of the existence of the <code>.git</code> directory, and what is inside. But have you ever heard about the sub-directories <code>.git/branches/</code> and <code>.git/remotes/</code>? As you might know, reference to branches are stored in <code>.git/refs/heads/</code>, so that&rsquo;s not what <code>.git/branches/</code> is for, and what about <code>.git/remotes/</code>?</p>
<p>Way back in 2005, <code>.git/branches/</code> was introduced to store a shorthand name for a remote, and a few months later they were moved to <code>.git/remotes/</code>. In 2006, <code>git-config(1)</code> learned to store remotes. This has become the standard way to configure remotes and, in 2011, the directories <code>.git/branches/</code> and <code>.git/remotes/</code> were documented as being &ldquo;legacy&rdquo; and no longer used in modern repositories.</p>
<p>In 2024, the document BreakingChanges was started to outline breaking changes for the next major version of Git (v3.0). While this release is not planned to happen any time soon, this document keeps track of changes that are expected to be part of that release. In 8ccc75c245, the use of the directories <code>.git/branches/</code> and <code>.git/remotes/</code> was added to this document and that officially marks as them deprecated and to be removed in Git 3.0.</p>
<p>Thanks to Patrick Steinhardt for formalizing this deprecation.</p>
<h2 id="rust-bindings-for-libgit-1">Rust bindings for libgit</h2>
<p>When compiling Git, an internal library <code>libgit.a</code> is made. This library contains some of the core functionality of Git.</p>
<p>While this library (and most of Git) is written in C, in Git 2.49 bindings were added to make some of these functions available in Rust. To achieve this, two new Cargo packages were created: <code>libgit-sys</code> and <code>libgit-rs</code>. These packages live in the <code>contrib/</code> subdirectory in the Git source tree.</p>
<p>It&rsquo;s pretty common to split out a library into two packages when a Foreign Function Interface is used. The <code>libgit-sys</code> package provides the pure interface to C functions and links to the native <code>libgit.a</code> library. The package <code>libgit-rs</code> provides a high-level interface to the functions in <code>libgit-sys</code> with a feel that is more idiomatic to Rust.</p>
<p>So far, the functionality in these Rust packages is very limited. It only provides an interface to interact with the <code>git-config(1)</code>.</p>
<p>This initiative was led by Josh Steadmon and was merged with a4af0b6288.</p>
<h2 id="new-name-hashing-algorithm-1">New name-hashing algorithm</h2>
<p>The Git object database in <code>.git/</code> stores most of its data in packfiles. And packfiles are also used to submit objects between Git server and client over the wire.</p>
<p>You can read all about the format at <code>gitformat-pack(5)</code>. One important aspect of the packfiles is delta-compression. With delta-compression not every object is stored as-is, but some objects are saved as a <em>delta</em> of another <em>base</em>. So instead of saving the full contents of the objects, changes compared to another object are stored.</p>
<p>Without going into the details how these deltas are calculated or stored, you can imagine that it is important group files together that are very similar. In v2.48 and earlier, Git looked at the last 16 characters of the path name to determine whether blobs might be similar. This algorithm is named version <code>1</code>.</p>
<p>In Git 2.49, version <code>2</code> is available. This is an iteration on version <code>1</code>, but modified so the effect of the parent directory is reduced. You can specify the name-hash algorithm version you want to use with option <code>--name-hash-version</code> of <code>git-repack(1)</code>.</p>
<p>Derrick Stolee, who drove this project, did some comparison in resulting packfile size after running <code>git repack -adf --name-hash-version=&lt;n&gt;</code>:</p>
<table>
  <thead>
      <tr>
          <th>Repo</th>
          <th>Version 1 size</th>
          <th>Version 2 size</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>fluentui</td>
          <td>440 MB</td>
          <td>161 MB</td>
      </tr>
      <tr>
          <td>Repo B</td>
          <td>6,248 MB</td>
          <td>856 MB</td>
      </tr>
      <tr>
          <td>Repo C</td>
          <td>37,278 MB</td>
          <td>6,921 MB</td>
      </tr>
      <tr>
          <td>Repo D</td>
          <td>131,204 MB</td>
          <td>7,463 MB</td>
      </tr>
  </tbody>
</table>
<p>You can read more of the details in the patch set, which is merged in aae91a86fb.</p>
<h2 id="promisor-remote-capability-1">Promisor remote capability</h2>
<p>It&rsquo;s known that Git isn&rsquo;t great in dealing with large files. There are some solutions to this problem, like Git LFS, but there are still some shortcomings. To give a few:</p>
<ul>
<li>With Git LFS the user has to configure which files to put in LFS. The server has no control about that and has to serve all files.</li>
<li>Whenever a file is committed to the repository, there is no way to get it out again without rewriting history. This is annoying, especially for large files, because they are stuck for eternity.</li>
<li>Users cannot change their mind on which files to put into Git LFS.</li>
<li>A tool like Git LFS requires significant effort to set up, learn, and use correctly.</li>
</ul>
<p>For some time, Git has had the concept of promisor remotes. This feature can be used to deal with large files, and in Git 2.49 this feature took a step forward.</p>
<p>The idea for the new “promisor-remote” capability is relatively simple: Instead of sending all objects itself, a Git server can tell to the Git client &ldquo;Hey, go download these objects from <em>XYZ</em>&rdquo;. <em>XYZ</em> would be a promisor remote.</p>
<p>Git 2.49 enables the server to advertise the information of the promisor remote to the client. This change is an extension to <code>gitprotocol-v2</code>. While the server and the client are transmitting data to each other, the server can send names and URLs of the promisor remotes it knows about.</p>
<p>So far, the client is not using the promisor remote info it gets from the server during clone, so all objects are still transmitted from the remote the clone initiated from. We are planning to continue work on this feature, making it use promisor remote info from the server, and making it easier to use.</p>
<p>This patch set was submitted by Christian Couder and merged with 2c6fd30198.</p>
<h2 id="thin-clone-using---revision-1">Thin clone using <code>--revision</code></h2>
<p>A new <code>--revision</code> option was added to <code>git-clone(1)</code>. This enables you to create a thin clone of a repository that only contains the history of the given revision. The option is similar to <code>--branch</code>, but accepts a ref name (like <code>refs/heads/main</code>, <code>refs/tags/v1.0</code>, and <code>refs/merge-requests/123</code>) or a hexadecimal commit object ID. The difference to <code>--branch</code> is that it does not create a tracking branch and detaches <code>HEAD</code>. This means it&rsquo;s not suited if you want to contribute back to that branch.</p>
<p>You can use <code>--revision</code> in combination with <code>--depth</code> to create a very minimal clone. A suggested use-case is for automated testing. When you have a CI system that needs to check out a branch (or any reference) to perform autonomous testing on the source code, having a minimal clone is all you need.</p>
<p>This change was driven by Toon Claes.</p>
<h1 id="read-more-1">Read more</h1>
<ul>
<li>What’s new in Git 2.48.0?</li>
<li>What’s new in Git 2.47.0?</li>
<li>What’s new in Git 2.46.0?</li>
</ul>
<p>Go to Source</p>

			</div>
		</article>
	</main>
<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/posts/2025-03-20-srsly-risky-biz-chinas-mss-gets-persona/">Srsly Risky Biz Chinas MSS gets personal</a></li>
				
				<li><a href="/posts/2025-03-19-risky-bulletin-google-buys-wiz-for-32-b/">Risky Bulletin Google buys Wiz for 32 billion</a></li>
				
				<li><a href="/posts/apple-inc-sent-you-a-payment-request-payoneer-invoices-other-microsoft-enabled-scams/">“Apple Inc sent you a payment request” Payoneer invoices; other Microsoft-enabled scams</a></li>
				
				<li><a href="/posts/glasses-that-transcribe-text-to-audio/">“Glasses” That Transcribe Text To Audio</a></li>
				
				<li><a href="/posts/5-best-linux-centos-replacement-options-alternatives/">&lt;div&gt;5 Best Linux CentOS Replacement Options &amp; Alternatives&lt;/div&gt;</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p>&copy; 2025 <a href="https://ghariib.ir/"><b>Alireza Gharib. All right reserved</b></a>.
	<a href="https://github.com/Gharib110"><b>Github</b></a>.
	</p>
</footer>

</body>
</html>
